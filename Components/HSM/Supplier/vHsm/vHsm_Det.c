/**********************************************************************************************************************
 *  COPYRIGHT
 *  -------------------------------------------------------------------------------------------------------------------
 *  \verbatim
 *  Copyright (c) 2022 by Vector Informatik GmbH.                                                  All rights reserved.
 *
 *                This software is copyright protected and proprietary to Vector Informatik GmbH.
 *                Vector Informatik GmbH grants to you only those rights as set out in the license conditions.
 *                All other rights remain with Vector Informatik GmbH.
 *  \endverbatim
 *  -------------------------------------------------------------------------------------------------------------------
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/*!        \file  vHsm_Det.c
 *        \brief  Source file for the vHsm_Det
 *
 *      \details  This module forwards the internal Det errors to the application
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  REVISION HISTORY
 *  -------------------------------------------------------------------------------------------------------------------
 *  Refer to the module's header file.
 *********************************************************************************************************************/

#define VHSM_DET_SOURCE

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "vHsm_Det.h"
#include "vHsm.h"
#include "vHsm_Core_Custom.h"
#include "vHsm_Ipc.h"
#include "vHsm_Trace.h"

/**********************************************************************************************************************
 *  LOCAL CONSTANT MACROS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION MACROS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA TYPES AND STRUCTURES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

#define VHSM_START_SEC_CODE
#include "MemMap.h" /* PRQA S 5087 */ /* MD_MSR_MemMap */

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  vHsm_Det_ReportError()
 *********************************************************************************************************************/
/*!
 * Internal comment removed.
 *
 *
 *
 *
 */
FUNC(Std_ReturnType, VHSM_CODE) vHsm_Det_ReportError(
  uint16 ModuleId,
  uint8 InstanceId,
  uint8 ApiId,
  uint8 ErrorId)
{
  /* VHSM_DEBUG_BREAKPOINT_1:
   * Set a breakpoint here to check if a DET occurred.
   */

  /* #10 Report the Det to the application core via the IPC */
  vHsm_Ipc_DetReportError(ModuleId, InstanceId, ApiId, ErrorId);

  /* #20 Print an error message on the debugger console */
  vHsm_Trace(VHSM_TRACETYPE_ERROR, "DEV ERROR DETECTED: ModuleId=%i, InstanceId=%i, ApiId=%i, ErrorId=%i\n", ModuleId, InstanceId, ApiId, ErrorId);

  /* #30 Write the Det to the error log */
  return vHsm_WriteErrorLog(VHSM_LOG_ID_DET, ((uint32)ModuleId << 16u) | ((uint32)ApiId << 8u) | ErrorId); /*lint !e522 */
}

#define VHSM_STOP_SEC_CODE
#include "MemMap.h" /* PRQA S 5087 */ /* MD_MSR_MemMap */

/**********************************************************************************************************************
 *  END OF FILE: vHsm_Det.c
 *********************************************************************************************************************/
